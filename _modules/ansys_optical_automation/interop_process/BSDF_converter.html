
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ansys_optical_automation.interop_process.BSDF_converter &#8212; Ansys Optical Automation  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=4ec06e9971c5264fbd345897d5258098f11cc577" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=8bf782fb4ee92b3d3646425e50f299c4e1fd152d"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/ansys_optical_automation/interop_process/BSDF_converter';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="None">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">Ansys Optical Automation  documentation</p>
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../resources/install.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../resources/CONTRIBUTE.html">
                        Contribute
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../api/modules.html">
                        ansys_optical_automation
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../resources/install.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../resources/CONTRIBUTE.html">
                        Contribute
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../api/modules.html">
                        ansys_optical_automation
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item">
  


<a class="navbar-brand logo" href="../../../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">Ansys Optical Automation  documentation</p>
  
</a>
    </div>
    <div class="sidebar-start-items__item">
<form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../resources/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/CONTRIBUTE.html">Contribute</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Index:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api/modules.html">ansys_optical_automation</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/ansys_optical_automation.html">ansys_optical_automation package</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/ansys_optical_automation.interop_process.html">ansys_optical_automation.interop_process package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/ansys_optical_automation.lumerical_core.html">ansys_optical_automation.lumerical_core package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/ansys_optical_automation.post_process.html">ansys_optical_automation.post_process package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/ansys_optical_automation.scdm_core.html">ansys_optical_automation.scdm_core package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/ansys_optical_automation.scdm_process.html">ansys_optical_automation.scdm_process package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/ansys_optical_automation.speos_process.html">ansys_optical_automation.speos_process package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/ansys_optical_automation.zemax_process.html">ansys_optical_automation.zemax_process package</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        <label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" data-toggle="tooltip" data-placement="right" title="Toggle primary sidebar">
            <span class="fa-solid fa-bars"></span>
        </label>
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="btn btn-sm"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

    </div>
</div>
            </div>
            
            

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

            <article class="bd-article" role="main">
              
  <h1>Source code for ansys_optical_automation.interop_process.BSDF_converter</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">bisect</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">nquad</span>

<span class="c1"># =========================================</span>
<span class="c1"># Speos BSDF Help files</span>
<span class="c1"># https://ansyshelp.ansys.com/account/secured?returnurl=/Views/Secured/corp/v222/en/Optis_UG_LAB/Optis/UG_Lab/structure_of_anisotropic_bsdf_files_81025.html</span>
<span class="c1"># Zemax BSDF Help files</span>
<span class="c1"># https://support.zemax.com/hc/en-us/articles/1500005486801-BSDF-Data-Interchange-file-format-specification</span>
<span class="c1"># =========================================</span>


<div class="viewcode-block" id="BsdfStructure"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure">[docs]</a><span class="k">class</span> <span class="nc">BsdfStructure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    class of BSDF data contains method to host bsdf data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        That functions initializes a class.</span>
<span class="sd">        filename_input: string</span>
<span class="sd">            filename of the imported bsdf</span>
<span class="sd">        zemax_or_speos: string</span>
<span class="sd">            &quot;zemax&quot; or &quot;speos&quot;</span>
<span class="sd">        scattertype: list</span>
<span class="sd">            list of string. 1 string per block of BSDF data- ex: [&quot;BRDF&quot;, &quot;BRDF&quot;, &quot;BTDF&quot;]</span>
<span class="sd">        symmetry: string</span>
<span class="sd">            &quot;Asymmetrical&quot;, &quot;PlaneSymmetrical&quot;</span>
<span class="sd">        wavelength: list</span>
<span class="sd">            list of wavelengths</span>
<span class="sd">        samplerotation: list</span>
<span class="sd">            list of sample rotations</span>
<span class="sd">        incidence: list</span>
<span class="sd">            list of angles of incidence</span>
<span class="sd">        tisdata: list</span>
<span class="sd">            list of total integrated scatter. Max TIS = 1</span>
<span class="sd">            The data is listed in that order: wavelength &gt; sample_rotation &gt; angleofincidence</span>
<span class="sd">        theta_input: list</span>
<span class="sd">            list of input theta (radial) angles</span>
<span class="sd">        phi_input: list</span>
<span class="sd">            list of input phi (azimuthal) angles</span>
<span class="sd">        theta: list</span>
<span class="sd">            list of theta angles</span>
<span class="sd">            The data is listed in that order: wavelength &gt; sample_rotation &gt; angleofincidence</span>
<span class="sd">        phi: list</span>
<span class="sd">            list of phi angles</span>
<span class="sd">            The data is listed in that order: wavelength &gt; sample_rotation &gt; angleofincidence</span>
<span class="sd">        bsdf_input: list</span>
<span class="sd">            list of block of bsdf data input</span>
<span class="sd">            The data is listed in that order: wavelength &gt; sample_rotation &gt; angleofincidence</span>
<span class="sd">        bsdf: list</span>
<span class="sd">            list of block of bsdf data</span>
<span class="sd">            The data is listed in that order: wavelength &gt; sample_rotation &gt; angleofincidence</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_input</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zemax_or_speos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scattertype</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samplerotation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incidence</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_scattertype</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_wavelength</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_samplerotation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_incidence</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_tisdata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;transmission_reflection&quot;</span><span class="p">,</span> <span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_rotation&quot;</span><span class="p">,</span> <span class="s2">&quot;angleofincidence&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;transmission_reflection&quot;</span><span class="p">,</span> <span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_rotation&quot;</span><span class="p">,</span> <span class="s2">&quot;angleofincidence&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;transmission_reflection&quot;</span><span class="p">,</span> <span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_rotation&quot;</span><span class="p">,</span> <span class="s2">&quot;angleofincidence&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;transmission_reflection&quot;</span><span class="p">,</span> <span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_rotation&quot;</span><span class="p">,</span> <span class="s2">&quot;angleofincidence&quot;</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;phi&quot;</span><span class="p">}</span>

<div class="viewcode-block" id="BsdfStructure.import_data"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.import_data">[docs]</a>    <span class="k">def</span> <span class="nf">import_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bool_log</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">input_file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_input</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">:]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">input_file_extension</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.bsdf&quot;</span><span class="p">,</span> <span class="s2">&quot;.brdf&quot;</span><span class="p">,</span> <span class="s2">&quot;.anisotropicbsdf&quot;</span><span class="p">]):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Nonsupported file selected&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">input_file_extension</span> <span class="o">==</span> <span class="s2">&quot;.bsdf&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zemax_or_speos</span> <span class="o">=</span> <span class="s2">&quot;zemax&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_zemax_bsdf</span><span class="p">(</span><span class="n">bool_log</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">converter_coordinate_system_bsdf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bool_log</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalize_bsdf_data</span><span class="p">(</span><span class="n">bool_log</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">input_file_extension</span> <span class="o">==</span> <span class="s2">&quot;.brdf&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zemax_or_speos</span> <span class="o">=</span> <span class="s2">&quot;speos&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_speos_brdf</span><span class="p">(</span><span class="n">bool_log</span><span class="p">)</span>
            <span class="c1"># self.phi_theta_output()</span>

        <span class="k">if</span> <span class="n">input_file_extension</span> <span class="o">==</span> <span class="s2">&quot;.anisotropicbsdf&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zemax_or_speos</span> <span class="o">=</span> <span class="s2">&quot;speos&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_speos_anisotropicbsdf</span><span class="p">(</span><span class="n">bool_log</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_tis_data</span><span class="p">(</span><span class="n">bool_log</span><span class="p">)</span></div>

<div class="viewcode-block" id="BsdfStructure.read_speos_brdf"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.read_speos_brdf">[docs]</a>    <span class="k">def</span> <span class="nf">read_speos_brdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bool_log</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        That function reads Speos BSDF file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bool_log : boolean</span>
<span class="sd">            0 --&gt; no report / 1 --&gt; reports values</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Reading file</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading Speos BSDF file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_input</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">bfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_input</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

        <span class="n">input_file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_input</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">:]</span>
        <span class="k">if</span> <span class="s2">&quot;brdf&quot;</span> <span class="ow">in</span> <span class="n">input_file_extension</span><span class="p">:</span>
            <span class="n">symmetry</span> <span class="o">=</span> <span class="s2">&quot;Asymmetrical&quot;</span>
        <span class="c1"># Read the header</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading header of Speos BSDF.....&quot;</span><span class="p">)</span>
        <span class="c1"># Row 1 : header</span>
        <span class="n">headerLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">headerLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">version</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&lt;</span> <span class="mf">8.0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The format is not supported. Open and save the file with the BSDF viewer to update the format.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Header = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">headerLine</span><span class="p">))</span>
        <span class="c1"># Row 2 : text 0 or binary 1</span>
        <span class="n">textorbinaryLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">textorbinary</span> <span class="o">=</span> <span class="n">textorbinaryLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">textorbinary</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The BSDF data cannot be read. It is not a text.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Text = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">textorbinaryLine</span><span class="p">))</span>
        <span class="c1"># Row 3 : Comment line</span>
        <span class="n">commentLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Comment = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">commentLine</span><span class="p">))</span>
        <span class="c1"># Row 4 : Number of characters to read for the measurement description. Several lines are allowed</span>
        <span class="n">nbmeasurementLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nbmeasurementLine = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nbmeasurementLine</span><span class="p">))</span>
        <span class="c1"># nbmeasurement = nbmeasurementLine[:-1].split(&quot;\t&quot;)</span>
        <span class="c1"># Row 5 : Measurement description (cannot be edited from the viewer).</span>
        <span class="n">measurementdescriptionLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;measurement description = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">measurementdescriptionLine</span><span class="p">))</span>
        <span class="c1"># Row 6: Contains two boolean values (0=false and 1=true) - reflection / transmission data</span>
        <span class="n">reflectionortransmissionLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">reflectionortransmissionString</span> <span class="o">=</span> <span class="n">reflectionortransmissionLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">reflectionortransmission</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reflectionortransmissionString</span><span class="p">]</span>
        <span class="c1"># Reflection: false or true</span>
        <span class="n">scatterType</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">reflectionortransmission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">scatterType</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BRDF&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reflectionortransmission</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">scatterType</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BTDF&quot;</span><span class="p">)</span>
        <span class="c1"># Row 7: Contains a boolean value describing the type of value stored in the file: 1 bsdf / 0 intensity</span>
        <span class="n">typeLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># Support only BSDF values for now</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">typeLine</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The values are not BSDF values but intensity values. It is not supported.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BSDF(1) or Intensity(0) values = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">typeLine</span><span class="p">))</span>
        <span class="c1"># Row 8: Number of incident angles and number of wavelength samples (in nanometer).</span>
        <span class="n">nbAngleIncidenceWavelengthLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">nbAngleIncidenceWavelength</span> <span class="o">=</span> <span class="n">nbAngleIncidenceWavelengthLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">nbAngleIncidence</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbAngleIncidenceWavelength</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">nbWavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbAngleIncidenceWavelength</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Row 9: List of the incident angles.</span>
        <span class="n">angleIncidenceLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">angleIncidenceString</span> <span class="o">=</span> <span class="n">angleIncidenceLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">angleIncidence</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">angleIncidenceString</span><span class="p">]</span>
        <span class="c1"># Row 10: List of the wavelength samples.</span>
        <span class="n">wavelengthLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">wavelengthString</span> <span class="o">=</span> <span class="n">wavelengthLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">wavelength</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">wavelengthString</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.....Header was correctly read</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># tempVariable = input(&#39;Press Enter to continue\n&#39;)</span>

        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading BSDF content.....&quot;</span><span class="p">)</span>

        <span class="c1"># Row 11: Reflection (or transmission) percentage for BRDF wavelength data normalization, for the first table.</span>
        <span class="c1"># NormalizationLine = bfile.readline()</span>
        <span class="c1"># Row 12: Number of angles measured for Theta and Phi</span>
        <span class="c1"># for the incident angle N°1 and the wavelength N°1 of the incident angle N°1.</span>

        <span class="n">nb_reflection_transmission</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scatterType</span><span class="p">)</span>
        <span class="c1"># tisData = np.zeros((nb_reflection_transmission * nbAngleIncidence, nbWavelength))</span>
        <span class="n">tisdata_temp_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scatterRadial_temp_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scatterAzimuth_temp_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bsdfData_temp_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_reflection_transmission</span> <span class="o">*</span> <span class="n">nbAngleIncidence</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbWavelength</span><span class="p">):</span>
                <span class="n">tisdata_temp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()))</span>
                <span class="n">nbthetaphiLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">nbthetaphi</span> <span class="o">=</span> <span class="n">nbthetaphiLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">nbScatterRadial</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbthetaphi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">nbScatterAzimuth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbthetaphi</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1"># nbScatterRadial_list.append(nbScatterRadial)</span>
                <span class="c1"># nbScatterAzimuth_list.append(nbScatterAzimuth)</span>

                <span class="n">scatterAzimuthLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">scatterAzimuthLineString</span> <span class="o">=</span> <span class="p">(</span><span class="n">scatterAzimuthLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">scatterAzimuth</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">scatterAzimuthLineString</span><span class="p">]</span>
                <span class="n">scatterAzimuth_temp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scatterAzimuth</span><span class="p">)</span>

                <span class="n">bsdfDataBlock</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbScatterRadial</span><span class="p">,</span> <span class="n">nbScatterAzimuth</span><span class="p">))</span>
                <span class="c1"># scatterRadial = np.zeros(nbScatterRadial)</span>
                <span class="n">scatterRadial</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbScatterRadial</span><span class="p">):</span>
                    <span class="n">dataLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">dataLine</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># scatterRadial[k] = float(data[0])</span>
                    <span class="n">scatterRadial</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">bsdfDataBlock</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

                <span class="c1"># If transmission data</span>
                <span class="k">if</span> <span class="n">scatterRadial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">90</span><span class="p">:</span>
                    <span class="c1"># change line theta from 90--&gt; 180 to 0--&gt;90</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="n">scatterRadial</span>
                    <span class="n">temp_180</span> <span class="o">=</span> <span class="p">[</span><span class="mi">180</span> <span class="o">-</span> <span class="n">temp</span><span class="p">[</span><span class="n">index_temp</span><span class="p">]</span> <span class="k">for</span> <span class="n">index_temp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">))]</span>
                    <span class="n">scatterRadial</span> <span class="o">=</span> <span class="n">temp_180</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># swap the radial / theta of the bsdf_block</span>
                    <span class="n">bsdfDataBlock</span> <span class="o">=</span> <span class="n">swap_rows</span><span class="p">(</span><span class="n">bsdfDataBlock</span><span class="p">)</span>

                <span class="n">scatterRadial_temp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scatterRadial</span><span class="p">)</span>
                <span class="n">bsdfData_temp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bsdfDataBlock</span><span class="p">)</span>

        <span class="c1"># Need to reorder</span>
        <span class="c1"># BRDF: RT --&gt; incidence --&gt; wavelength</span>
        <span class="c1"># Format: RT --&gt; wavelength --&gt; incidence</span>
        <span class="n">tisdata_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scatterRadial_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scatterAzimuth_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bsdfData_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">incidence_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wavelength_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scatterType_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">samplerotation</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">samplerotation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">samplerotation_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">index_RT</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_reflection_transmission</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">index_wavelength</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbWavelength</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">index_incidence</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbAngleIncidence</span><span class="p">):</span>
                    <span class="n">index_block</span> <span class="o">=</span> <span class="p">((</span><span class="n">index_incidence</span> <span class="o">*</span> <span class="n">nbWavelength</span><span class="p">)</span> <span class="o">+</span> <span class="n">index_wavelength</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
                        <span class="n">index_RT</span> <span class="o">*</span> <span class="n">nbWavelength</span> <span class="o">*</span> <span class="n">nbAngleIncidence</span>
                    <span class="p">)</span>
                    <span class="n">scatterType_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scatterType</span><span class="p">[</span><span class="n">index_RT</span><span class="p">])</span>
                    <span class="n">wavelength_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wavelength</span><span class="p">[</span><span class="n">index_wavelength</span><span class="p">])</span>
                    <span class="n">samplerotation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">incidence_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angleIncidence</span><span class="p">[</span><span class="n">index_incidence</span><span class="p">])</span>
                    <span class="n">tisdata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tisdata_temp_list</span><span class="p">[</span><span class="n">index_block</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="n">scatterRadial_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scatterRadial_temp_list</span><span class="p">[</span><span class="n">index_block</span><span class="p">])</span>
                    <span class="n">scatterAzimuth_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scatterAzimuth_temp_list</span><span class="p">[</span><span class="n">index_block</span><span class="p">])</span>
                    <span class="n">bsdfData_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bsdfData_temp_list</span><span class="p">[</span><span class="n">index_block</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.....BSDF data was correctly read</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1">#    return scatterType, BSDFType, nbSampleRotation, nbAngleIncidence, nbScatterAzimuth, nbScatterRadial, \</span>
        <span class="c1">#           angleIncidence, wavelength, scatterRadial, scatterAzimuth, tisData, bsdfData</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scattertype</span> <span class="o">=</span> <span class="n">scatterType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">symmetry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">wavelength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samplerotation</span> <span class="o">=</span> <span class="n">samplerotation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incidence</span> <span class="o">=</span> <span class="n">angleIncidence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_scattertype</span> <span class="o">=</span> <span class="n">scatterType_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_wavelength</span> <span class="o">=</span> <span class="n">wavelength_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_samplerotation</span> <span class="o">=</span> <span class="n">samplerotation_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_incidence</span> <span class="o">=</span> <span class="n">incidence_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_tisdata</span> <span class="o">=</span> <span class="n">tisdata_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span> <span class="o">=</span> <span class="n">scatterRadial_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span> <span class="o">=</span> <span class="n">scatterAzimuth_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span> <span class="o">=</span> <span class="n">bsdfData_list</span></div>

<div class="viewcode-block" id="BsdfStructure.read_speos_anisotropicbsdf"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.read_speos_anisotropicbsdf">[docs]</a>    <span class="k">def</span> <span class="nf">read_speos_anisotropicbsdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bool_log</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        That function reads Speos anisotropicbsdf file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bool_log : boolean</span>
<span class="sd">            0 --&gt; no report / 1 --&gt; reports values</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">samplerotation_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">angleIncidence_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wavelength_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">RT_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tisdata_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nbWavelength</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Reading file</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading Speos anisotropicbsdf file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_input</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">bfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_input</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

        <span class="n">input_file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_input</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">:]</span>
        <span class="k">if</span> <span class="s2">&quot;anisotropicbsdf&quot;</span> <span class="ow">in</span> <span class="n">input_file_extension</span><span class="p">:</span>
            <span class="n">symmetry</span> <span class="o">=</span> <span class="s2">&quot;Asymmetrical4D&quot;</span>
        <span class="c1"># Read the header</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading header of Speos BSDF.....&quot;</span><span class="p">)</span>
        <span class="c1"># Row 1 : header</span>
        <span class="n">headerLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">headerLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">version</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&lt;</span> <span class="mf">8.0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The format is not supported. Open and save the file with the BSDF viewer to update the format.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Header = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">headerLine</span><span class="p">))</span>
        <span class="c1"># Row 2 : text 0 or binary 1</span>
        <span class="n">textorbinaryLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">textorbinary</span> <span class="o">=</span> <span class="n">textorbinaryLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">textorbinary</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The BSDF data cannot be read. It is not a text.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Text = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">textorbinaryLine</span><span class="p">))</span>
        <span class="c1"># Row 3 : Comment line</span>
        <span class="n">commentLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Comment = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">commentLine</span><span class="p">))</span>
        <span class="c1"># Row 4 : Number of characters to read for the measurement description. Several lines are allowed</span>
        <span class="n">nbmeasurementLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nbmeasurementLine = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nbmeasurementLine</span><span class="p">))</span>
        <span class="c1"># nbmeasurement = nbmeasurementLine[:-1].split(&quot;\t&quot;)</span>
        <span class="c1"># Row 5 : Measurement description (cannot be edited from the viewer).</span>
        <span class="n">measurementdescriptionLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;measurement description = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">measurementdescriptionLine</span><span class="p">))</span>
        <span class="c1"># Row 6: Contains the anisotropy vector in the global coordinates system</span>
        <span class="n">anisotropyvectorLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">anisotropyvectorString</span> <span class="o">=</span> <span class="n">anisotropyvectorLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">anisotropyvector</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">anisotropyvectorString</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The anisotropy vector is = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">anisotropyvector</span><span class="p">))</span>

        <span class="c1"># if not (anisotropyvector == [0, 1, 0]):</span>
        <span class="c1">#    msg = &quot;Only the (0,1,0) anisotropy vector is supported for now&quot;</span>
        <span class="c1">#    raise TypeError(msg)</span>

        <span class="c1"># Row 7: Contains two boolean values (0=false and 1=true) - reflection / transmission data</span>
        <span class="n">reflectionortransmissionLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">reflectionortransmissionString</span> <span class="o">=</span> <span class="n">reflectionortransmissionLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">reflectionortransmission</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reflectionortransmissionString</span><span class="p">]</span>
        <span class="c1"># Reflection: false or true</span>
        <span class="n">scatterType</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">reflectionortransmission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">scatterType</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BRDF&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reflectionortransmission</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">scatterType</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BTDF&quot;</span><span class="p">)</span>
        <span class="c1"># Row 8: Contains a boolean value describing the type of value stored in the file: 1 bsdf / 0 intensity</span>
        <span class="n">typeLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># Support only BSDF values for now</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">typeLine</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The values are not BSDF values but intensity values. It is not supported.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BSDF(1) or Intensity(1) values = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">typeLine</span><span class="p">))</span>
        <span class="c1"># scattertype_nb_list = []</span>

        <span class="c1"># Reflection</span>
        <span class="k">if</span> <span class="n">reflectionortransmission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Row 9: Number of anisotropy angles in reflection.</span>
            <span class="n">nbsamplerotationLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">nbsamplerotation_reflection</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbsamplerotationLine</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="c1"># Row 10: List of anisotropy angles in reflection.</span>
            <span class="n">samplerotationLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">samplerotationString</span> <span class="o">=</span> <span class="n">samplerotationLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">samplerotation</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">samplerotationString</span><span class="p">]</span>
            <span class="c1"># samplerotation_list.append(samplerotation_reflection)</span>
            <span class="k">for</span> <span class="n">index_samplerotation</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbsamplerotation_reflection</span><span class="p">):</span>
                <span class="c1"># Row 11: Number of incident angles in reflection, for anisotropy angle N°1</span>
                <span class="n">nbAngleIncidenceLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">nbAngleIncidence</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbAngleIncidenceLine</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">index_incidence</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbAngleIncidence</span><span class="p">):</span>
                    <span class="n">samplerotation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samplerotation</span><span class="p">[</span><span class="n">index_samplerotation</span><span class="p">])</span>
                    <span class="n">RT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BRDF&quot;</span><span class="p">)</span>
                <span class="c1"># Row 12: List of incident angles in reflection, for anisotropy angle N°1.</span>
                <span class="n">angleIncidenceLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">angleIncidenceString</span> <span class="o">=</span> <span class="n">angleIncidenceLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">angleIncidence</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">angleIncidenceString</span><span class="p">]</span>
                <span class="n">angleIncidence_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">angleIncidence</span><span class="p">)</span>
                <span class="c1"># Check that the angle of incidences are identical</span>
                <span class="k">if</span> <span class="n">index_samplerotation</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">angleIncidence</span> <span class="o">==</span> <span class="n">save_angleIncidence</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The angle of incidences must be identical for all the sample rotations.&quot;</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">save_angleIncidence</span> <span class="o">=</span> <span class="n">angleIncidence</span>

        <span class="c1"># Transmission</span>
        <span class="k">if</span> <span class="n">reflectionortransmission</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Row 13: Number of anisotropy angles in transmission</span>
            <span class="n">nbsamplerotationLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">nbsamplerotation_transmission</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbsamplerotationLine</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nbsamplerotation_reflection</span> <span class="o">==</span> <span class="n">nbsamplerotation_transmission</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The number of sample rotation in transmission and reflection have to be equal.&quot;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="c1"># Row 14: List of anisotropy angles in reflection.</span>
            <span class="n">samplerotationLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">samplerotationString</span> <span class="o">=</span> <span class="n">samplerotationLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">samplerotation</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">samplerotationString</span><span class="p">]</span>
            <span class="c1"># samplerotation_list.append(samplerotation_transmission)</span>
            <span class="k">for</span> <span class="n">index_samplerotation</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbsamplerotation_transmission</span><span class="p">):</span>
                <span class="c1"># Row 15: Number of incident angles in reflection, for anisotropy angle N°1</span>
                <span class="n">nbAngleIncidenceLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">nbAngleIncidence</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbAngleIncidenceLine</span><span class="o">.</span><span class="n">strip</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">index_incidence</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbAngleIncidence</span><span class="p">):</span>
                    <span class="n">samplerotation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samplerotation</span><span class="p">[</span><span class="n">index_samplerotation</span><span class="p">])</span>
                    <span class="n">RT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BTDF&quot;</span><span class="p">)</span>
                <span class="c1"># Row 16: List of incident angles in reflection, for anisotropy angle N°1.</span>
                <span class="n">angleIncidenceLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">angleIncidenceString</span> <span class="o">=</span> <span class="n">angleIncidenceLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">angleIncidence</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">angleIncidenceString</span><span class="p">]</span>
                <span class="n">angleIncidence_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">angleIncidence</span><span class="p">)</span>
                <span class="c1"># Check that the angle of incidences are identical</span>
                <span class="k">if</span> <span class="n">index_samplerotation</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">reflectionortransmission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">angleIncidence</span> <span class="o">==</span> <span class="n">save_angleIncidence</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The angle of incidences must be identical for all the sample rotations.&quot;</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">save_angleIncidence</span> <span class="o">=</span> <span class="n">angleIncidence</span>

        <span class="n">wavelength</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Reflection</span>
        <span class="k">if</span> <span class="n">reflectionortransmission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Row 17: Theta angle and a Phi angle for each spectrum measurement in reflection.</span>
            <span class="n">theta_phi_reflection_reference_Line</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Theta and Phi angles in reflection. = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">theta_phi_reflection_reference_Line</span><span class="p">))</span>
            <span class="c1"># Row 18: Reflective Spectrum description: wavelength (nm), coefficient (%)</span>
            <span class="n">theta_phi_reflection_comment_Line</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reflection: wavelength (nm), coefficient (%) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">theta_phi_reflection_comment_Line</span><span class="p">))</span>
            <span class="c1"># Row 19: Number of wavelength measurements in reflection</span>
            <span class="n">nbWavelength_reflection_Line</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">nbWavelength_reflection</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbWavelength_reflection_Line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">nbWavelength</span> <span class="o">=</span> <span class="n">nbWavelength_reflection</span>
            <span class="c1"># Row 20: Wavelength measurements in reflection (in nm). One wavelength takes one line.</span>
            <span class="n">wavelength_reflection_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index_wavelength</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbWavelength_reflection</span><span class="p">):</span>
                <span class="n">Wavelength_reflection_Line</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">Wavelength_reflection_String</span> <span class="o">=</span> <span class="n">Wavelength_reflection_Line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">Wavelength_reflection</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Wavelength_reflection_String</span><span class="p">]</span>
                <span class="n">wavelength_reflection_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Wavelength_reflection</span><span class="p">)</span>
            <span class="n">index_middle_wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelength_reflection_list</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">wavelength</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wavelength_reflection_list</span><span class="p">[</span><span class="n">index_middle_wavelength</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">tisdata_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">wavelength_reflection_list</span><span class="p">[</span><span class="n">index_middle_wavelength</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
        <span class="c1"># Transmission</span>
        <span class="k">if</span> <span class="n">reflectionortransmission</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Row 21: Theta angle and a Phi angle for each spectrum measurement in transmission.</span>
            <span class="n">theta_phi_transmission_reference_Line</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Theta and Phi angles in transmission. = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">theta_phi_transmission_reference_Line</span><span class="p">))</span>
            <span class="c1"># Row 22: Transmission Spectrum description: wavelength (nm), coefficient (%)</span>
            <span class="n">theta_phi_transmission_comment_Line</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Transmission: wavelength (nm), coefficient (%) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">theta_phi_transmission_comment_Line</span><span class="p">))</span>
            <span class="c1"># Row 23: Number of wavelength measurements in transmission.</span>
            <span class="n">nbWavelength_transmission_Line</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">nbWavelength_transmission</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbWavelength_transmission_Line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">nbWavelength</span> <span class="o">=</span> <span class="n">nbWavelength</span> <span class="o">+</span> <span class="n">nbWavelength_transmission</span>
            <span class="c1"># Row 24: Wavelength measurements in transmission (in nm).</span>
            <span class="n">wavelength_transmission_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index_wavelength</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbWavelength_transmission</span><span class="p">):</span>
                <span class="n">Wavelength_transmission_Line</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">Wavelength_transmission_String</span> <span class="o">=</span> <span class="n">Wavelength_transmission_Line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">Wavelength_transmission</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Wavelength_transmission_String</span><span class="p">]</span>
                <span class="n">wavelength_transmission_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Wavelength_transmission</span><span class="p">)</span>
            <span class="n">index_middle_wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelength_transmission_list</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1"># wavelength_list.append(wavelength_tis_list[index_middle_wavelength][0])</span>
            <span class="n">tisdata_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">wavelength_transmission_list</span><span class="p">[</span><span class="n">index_middle_wavelength</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.....Header was correctly read</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># tempVariable = input(&#39;Press Enter to continue\n&#39;)</span>

        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading BSDF content.....&quot;</span><span class="p">)</span>

        <span class="c1"># tisData = np.zeros((nb_reflection_transmission * nbAngleIncidence, nbWavelength))</span>
        <span class="n">scatterRadial_temp_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scatterAzimuth_temp_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bsdfData_temp_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># reflection</span>
        <span class="k">for</span> <span class="n">index_block</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">angleIncidence_list</span><span class="p">)):</span>
            <span class="n">nbthetaphiLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">nbthetaphi</span> <span class="o">=</span> <span class="n">nbthetaphiLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">nbScatterRadial</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbthetaphi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">nbScatterAzimuth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbthetaphi</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">scatterAzimuthLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">scatterAzimuthLineString</span> <span class="o">=</span> <span class="p">(</span><span class="n">scatterAzimuthLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">scatterAzimuth</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">scatterAzimuthLineString</span><span class="p">]</span>
            <span class="n">scatterAzimuth_temp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scatterAzimuth</span><span class="p">)</span>

            <span class="n">bsdfDataBlock</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbScatterRadial</span><span class="p">,</span> <span class="n">nbScatterAzimuth</span><span class="p">))</span>
            <span class="n">scatterRadial</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbScatterRadial</span><span class="p">):</span>
                <span class="n">dataLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">dataLine</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">scatterRadial</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">bsdfDataBlock</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="c1"># If transmission data</span>
            <span class="k">if</span> <span class="n">scatterRadial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">90</span><span class="p">:</span>
                <span class="c1"># change line theta from 90--&gt; 180 to 0--&gt;90</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">scatterRadial</span>
                <span class="n">temp_180</span> <span class="o">=</span> <span class="p">[</span><span class="mi">180</span> <span class="o">-</span> <span class="n">temp</span><span class="p">[</span><span class="n">index_temp</span><span class="p">]</span> <span class="k">for</span> <span class="n">index_temp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">))]</span>
                <span class="n">scatterRadial</span> <span class="o">=</span> <span class="n">temp_180</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># swap the radial / theta of the bsdf_block</span>
                <span class="n">bsdfDataBlock</span> <span class="o">=</span> <span class="n">swap_rows</span><span class="p">(</span><span class="n">bsdfDataBlock</span><span class="p">)</span>

            <span class="n">scatterRadial_temp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scatterRadial</span><span class="p">)</span>
            <span class="n">bsdfData_temp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bsdfDataBlock</span><span class="p">)</span>

        <span class="c1"># Need to reorder</span>
        <span class="c1"># BRDF: RT --&gt; incidence --&gt; wavelength</span>
        <span class="c1"># Format: RT --&gt; wavelength --&gt; incidence</span>
        <span class="n">scatterRadial_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scatterAzimuth_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bsdfData_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">index_block</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">angleIncidence_list</span><span class="p">)):</span>
            <span class="c1"># tisdata_list.append(tisdata_temp_list[index_block]/100)</span>
            <span class="n">wavelength_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wavelength</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">scatterRadial_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scatterRadial_temp_list</span><span class="p">[</span><span class="n">index_block</span><span class="p">])</span>
            <span class="n">scatterAzimuth_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scatterAzimuth_temp_list</span><span class="p">[</span><span class="n">index_block</span><span class="p">])</span>
            <span class="n">bsdfData_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bsdfData_temp_list</span><span class="p">[</span><span class="n">index_block</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.....BSDF data was correctly read</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scattertype</span> <span class="o">=</span> <span class="n">scatterType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">symmetry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">wavelength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samplerotation</span> <span class="o">=</span> <span class="n">samplerotation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incidence</span> <span class="o">=</span> <span class="n">angleIncidence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_scattertype</span> <span class="o">=</span> <span class="n">RT_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_wavelength</span> <span class="o">=</span> <span class="n">wavelength_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_samplerotation</span> <span class="o">=</span> <span class="n">samplerotation_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_incidence</span> <span class="o">=</span> <span class="n">angleIncidence_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_tisdata</span> <span class="o">=</span> <span class="n">tisdata_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span> <span class="o">=</span> <span class="n">scatterRadial_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span> <span class="o">=</span> <span class="n">scatterAzimuth_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span> <span class="o">=</span> <span class="n">bsdfData_list</span></div>

<div class="viewcode-block" id="BsdfStructure.read_zemax_bsdf"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.read_zemax_bsdf">[docs]</a>    <span class="k">def</span> <span class="nf">read_zemax_bsdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bool_log</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        That function reads Zemax BSDF file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bool_log : boolean</span>
<span class="sd">            0 --&gt; no report / 1 --&gt; reports values</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Reading file</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading Zemax BSDF file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_input</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">bfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_input</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

        <span class="c1"># Read the header</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading header of Zemax BSDF.....&quot;</span><span class="p">)</span>
        <span class="c1"># Source type</span>
        <span class="n">sourceLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">sourceLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">sourceLine</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">sourceLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># source = sourceLine[8:-1]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">sourceLine</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Source = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
        <span class="c1"># Symmetry type</span>
        <span class="n">symmetryLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">symmetryLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
            <span class="n">symmetryLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># symmetry = symmetryLine[10:-1]</span>
        <span class="n">symmetry</span> <span class="o">=</span> <span class="n">symmetryLine</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">symmetry</span> <span class="o">=</span> <span class="n">symmetry</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Symmetry = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symmetry</span><span class="p">))</span>
        <span class="c1"># Spectral content type</span>
        <span class="n">spectralContentLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">spectralContentLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
            <span class="n">spectralContentLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># spectralContent = spectralContentLine[17:-1]</span>
        <span class="n">spectralContent</span> <span class="o">=</span> <span class="n">spectralContentLine</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">spectralContent</span> <span class="o">=</span> <span class="n">spectralContent</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Spectral content = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectralContent</span><span class="p">))</span>
        <span class="c1"># Scatter type</span>
        <span class="n">scatterTypeLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">scatterTypeLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
            <span class="n">scatterTypeLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># scatterType = scatterTypeLine[13:-1]</span>
        <span class="n">scatterType</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">scatterTypeLine</span><span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">scatterType</span> <span class="o">=</span> <span class="n">scatterType</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scatter type = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scatterType</span><span class="p">))</span>
        <span class="c1"># Number sample rotation</span>
        <span class="n">sampleRotationLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">sampleRotationLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
            <span class="n">sampleRotationLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># nbSampleRotation = int(sampleRotationLine[16:-1])</span>
        <span class="n">nbSampleRotation</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sampleRotationLine</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nb sample rotation = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nbSampleRotation</span><span class="p">))</span>
        <span class="c1"># Sample rotation values</span>
        <span class="n">sampleRotationLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">sampleRotationLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
            <span class="n">sampleRotationLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># sampleRotation = sampleRotationLine[:-1].split(&#39;\t&#39;)</span>
        <span class="n">sampleRotationString</span> <span class="o">=</span> <span class="n">sampleRotationLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">sampleRotationString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">sampleRotationString</span> <span class="o">=</span> <span class="n">sampleRotationString</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sampleRotationString</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nbSampleRotation</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Wrong data for sample rotation values&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sampleRotation</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sampleRotationString</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sample rotation angle values : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sampleRotationString</span><span class="p">))</span>
        <span class="c1"># Number angle incidence</span>
        <span class="n">angleIncidenceLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">angleIncidenceLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
            <span class="n">angleIncidenceLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># nbAngleIncidence = int(angleIncidenceLine[18:-1])</span>
        <span class="n">nbAngleIncidence</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">angleIncidenceLine</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nb angle incidence = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nbAngleIncidence</span><span class="p">))</span>
        <span class="c1"># Angle incidence values</span>
        <span class="n">angleIncidenceLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">angleIncidenceLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
            <span class="n">angleIncidenceLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># Split can be tabular or white spaces</span>
        <span class="c1"># angleIncidence = angleIncidenceLine[:-1].split(&#39;\t&#39;)</span>
        <span class="n">angleIncidenceString</span> <span class="o">=</span> <span class="n">angleIncidenceLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">angleIncidenceString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">angleIncidenceString</span> <span class="o">=</span> <span class="n">angleIncidenceString</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">angleIncidenceString</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nbAngleIncidence</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Wrong data for angle incidence values&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">angleIncidence</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">angleIncidenceString</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Angle incidence angle values : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">angleIncidenceString</span><span class="p">))</span>
        <span class="c1"># Number scatter azimuth</span>
        <span class="n">scatterAzimuthLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">scatterAzimuthLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
            <span class="n">scatterAzimuthLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># nbScatterAzimuth = int(scatterAzimuthLine[15:-1])</span>
        <span class="n">nbScatterAzimuth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scatterAzimuthLine</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nb scatter azimuth = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nbScatterAzimuth</span><span class="p">))</span>
        <span class="c1"># Scatter azimuth values</span>
        <span class="n">scatterAzimuthLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">scatterAzimuthLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
            <span class="n">scatterAzimuthLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># scatterAzimuth = scatterAzimuthLine[:-1].split(&#39;\t&#39;)</span>
        <span class="n">scatterAzimuthString</span> <span class="o">=</span> <span class="n">scatterAzimuthLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">scatterAzimuthString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">scatterAzimuthString</span> <span class="o">=</span> <span class="n">scatterAzimuthString</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scatterAzimuthString</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nbScatterAzimuth</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Wrong data for scatter azimuth values&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="c1"># tempVariable = input(&quot;.....Press Enter to continue&quot;)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scatterAzimuth</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">scatterAzimuthString</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scatter azimuth angle values : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scatterAzimuthString</span><span class="p">))</span>
        <span class="c1"># Number scatter radial</span>
        <span class="n">scatterRadialLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">scatterRadialLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
            <span class="n">scatterRadialLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># nbScatterRadial = int(scatterRadialLine[14:-1])</span>
        <span class="n">nbScatterRadial</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scatterRadialLine</span><span class="p">[</span><span class="mi">13</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nb scatter radial = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nbScatterRadial</span><span class="p">))</span>
        <span class="c1"># Scatter radial values</span>
        <span class="n">scatterRadialLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">scatterRadialLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
            <span class="n">scatterRadialLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># scatterRadial = scatterRadialLine[:-1].split(&#39;\t&#39;)</span>
        <span class="n">scatterRadialString</span> <span class="o">=</span> <span class="n">scatterRadialLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">scatterRadialString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">scatterRadialString</span> <span class="o">=</span> <span class="n">scatterRadialString</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scatterRadialString</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nbScatterRadial</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;WARNING: Wrong data for scatter radial values&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="c1"># tempVariable = input(&quot;.....Press Enter to continue&quot;)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scatterRadial</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">scatterRadialString</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scatter radial angle values : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scatterRadialString</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.....Header was correctly read</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># tempVariable = input(&#39;Press Enter to continue\n&#39;)</span>

        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading BSDF content.....&quot;</span><span class="p">)</span>
        <span class="n">dataLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">dataLine</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;DataBegin&quot;</span><span class="p">:</span>
            <span class="n">dataLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># Initialization of a bsdfData list</span>
        <span class="c1"># Initialization of a vector tisData to save the TIS at each sample rotation and angle of incidence</span>

        <span class="n">bsdfData_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">theta_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phi_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wavelength_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># tisData = np.zeros((nbSampleRotation, nbAngleIncidence))</span>
        <span class="n">tisData_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scattertype_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scattertype_data_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sampleRotation_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">angleIncidence_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">scattertype_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scatterType</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index_samplerotation</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbSampleRotation</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">index_incidence</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbAngleIncidence</span><span class="p">):</span>
                <span class="c1"># Reading TIS (Total Integrated Scatter) value</span>
                <span class="n">tisLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="c1"># tisData[index_samplerotation][index_incidence] = float(tisLine[4:-1])</span>
                <span class="n">tisData_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tisLine</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">wavelength_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.55</span><span class="p">)</span>
                <span class="n">sampleRotation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sampleRotation</span><span class="p">[</span><span class="n">index_samplerotation</span><span class="p">])</span>
                <span class="n">angleIncidence_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angleIncidence</span><span class="p">[</span><span class="n">index_incidence</span><span class="p">])</span>
                <span class="n">scattertype_data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scatterType</span><span class="p">)</span>
                <span class="n">bsdfData_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbScatterAzimuth</span><span class="p">,</span> <span class="n">nbScatterRadial</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">index_phi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbScatterAzimuth</span><span class="p">):</span>
                    <span class="n">dataLine</span> <span class="o">=</span> <span class="n">bfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="n">bsdfData_block</span><span class="p">[</span><span class="n">index_phi</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataLine</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">bsdfData_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bsdfData_block</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
                <span class="n">theta_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scatterRadial</span><span class="p">)</span>
                <span class="n">phi_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scatterAzimuth</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.....BSDF data was correctly read</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scattertype</span> <span class="o">=</span> <span class="n">scattertype_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">symmetry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.55</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samplerotation</span> <span class="o">=</span> <span class="n">sampleRotation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incidence</span> <span class="o">=</span> <span class="n">angleIncidence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_wavelength</span> <span class="o">=</span> <span class="n">wavelength_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_scattertype</span> <span class="o">=</span> <span class="n">scattertype_data_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_samplerotation</span> <span class="o">=</span> <span class="n">sampleRotation_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_incidence</span> <span class="o">=</span> <span class="n">angleIncidence_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_tisdata</span> <span class="o">=</span> <span class="n">tisData_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span> <span class="o">=</span> <span class="n">theta_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span> <span class="o">=</span> <span class="n">phi_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span> <span class="o">=</span> <span class="n">bsdfData_list</span></div>

<div class="viewcode-block" id="BsdfStructure.obsolete_phi_theta_output"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.obsolete_phi_theta_output">[docs]</a>    <span class="k">def</span> <span class="nf">obsolete_phi_theta_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        That function writes the text nLines in the file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Limitation</span>
        <span class="n">nbTheta_max</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">nbPhi_max</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zemax_or_speos</span> <span class="o">==</span> <span class="s2">&quot;speos&quot;</span><span class="p">:</span>
            <span class="n">theta_max</span> <span class="o">=</span> <span class="mi">180</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theta_max</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="n">phi_max</span> <span class="o">=</span> <span class="mi">360</span>
        <span class="c1"># if bsdfstructure_input.symmetry == &quot;PlaneSymmetrical&quot;:</span>
        <span class="c1">#    phi_max = 180</span>
        <span class="c1">#    nbPhi_max = 500</span>

        <span class="c1"># Default values</span>
        <span class="n">precisionTheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_input</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_input</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">precisionPhi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_input</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_input</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">nbTheta</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">theta_max</span> <span class="o">/</span> <span class="n">precisionTheta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">nbPhi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">phi_max</span> <span class="o">/</span> <span class="n">precisionPhi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">nbTheta</span> <span class="o">&gt;</span> <span class="n">nbTheta_max</span><span class="p">:</span>
            <span class="n">precisionTheta</span> <span class="o">=</span> <span class="mf">0.1</span>
            <span class="n">nbTheta</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">theta_max</span> <span class="o">/</span> <span class="n">precisionTheta</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nbPhi</span> <span class="o">&gt;</span> <span class="n">nbPhi_max</span><span class="p">:</span>
            <span class="n">precisionPhi</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="n">nbPhi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbPhi_max</span> <span class="o">/</span> <span class="n">precisionPhi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Precision Theta = &quot;</span><span class="p">,</span> <span class="n">precisionTheta</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Precision Phi = &quot;</span><span class="p">,</span> <span class="n">precisionPhi</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span> <span class="o">=</span> <span class="p">[(</span><span class="n">precisionTheta</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbTheta</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span> <span class="o">=</span> <span class="p">[(</span><span class="n">precisionPhi</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbPhi</span><span class="p">)]</span></div>

<div class="viewcode-block" id="BsdfStructure.converter_coordinate_system_bsdf"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.converter_coordinate_system_bsdf">[docs]</a>    <span class="k">def</span> <span class="nf">converter_coordinate_system_bsdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bool_normal_1</span><span class="p">,</span> <span class="n">bool_log</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        That function converts the bsdf data</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Converting data...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">line_theta_output_list</span><span class="p">,</span> <span class="n">line_phi_output_list</span> <span class="o">=</span> <span class="n">phi_theta_output</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zemax_or_speos</span>
        <span class="p">)</span>
        <span class="n">line_theta_output</span> <span class="o">=</span> <span class="n">line_theta_output_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">line_phi_output</span> <span class="o">=</span> <span class="n">line_phi_output_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># nb_wavelength = len(self.wavelength)</span>
        <span class="c1"># nb_samplerotation = len(self.samplerotation)</span>
        <span class="c1"># nb_angleofincidence = len(self.incidence)</span>
        <span class="c1"># nb_reflection_transmission = len(self.scattertype)</span>
        <span class="c1"># bsdf_output = self.bsdf</span>

        <span class="c1"># index_block = 0</span>

        <span class="k">for</span> <span class="n">index_block</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_incidence</span><span class="p">)):</span>
            <span class="n">current_angleofincidence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_incidence</span><span class="p">[</span><span class="n">index_block</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">line_theta_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">line_phi_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line_theta_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">[</span><span class="n">index_block</span><span class="p">]</span>
                <span class="n">line_phi_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span><span class="p">[</span><span class="n">index_block</span><span class="p">]</span>
            <span class="n">bsdfData_output_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">line_theta_output</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_phi_output</span><span class="p">)))</span>

            <span class="k">for</span> <span class="n">index_theta</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line_theta_output</span><span class="p">)):</span>
                <span class="n">currentTheta</span> <span class="o">=</span> <span class="n">line_theta_output</span><span class="p">[</span><span class="n">index_theta</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">index_phi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line_phi_output</span><span class="p">)):</span>
                    <span class="n">currentPhi</span> <span class="o">=</span> <span class="n">line_phi_output</span><span class="p">[</span><span class="n">index_phi</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">bool_normal_1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># Convert the angles to the &quot;specular&quot; definition</span>
                        <span class="n">newTheta</span><span class="p">,</span> <span class="n">newPhi</span> <span class="o">=</span> <span class="n">convert_normal_to_specular_using_cartesian</span><span class="p">(</span>
                            <span class="n">currentTheta</span><span class="p">,</span> <span class="n">currentPhi</span><span class="p">,</span> <span class="n">current_angleofincidence</span>
                        <span class="p">)</span>
                        <span class="c1"># Added the case where symmetry == PlaneSymmetrical</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">==</span> <span class="s2">&quot;PlaneSymmetrical&quot;</span> <span class="ow">and</span> <span class="n">newPhi</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
                            <span class="n">newPhi</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">newPhi</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Convert the angles to the &quot;normal&quot; definition</span>
                        <span class="n">newTheta</span><span class="p">,</span> <span class="n">newPhi</span> <span class="o">=</span> <span class="n">convert_specular_to_normal_using_cartesian</span><span class="p">(</span>
                            <span class="n">currentTheta</span><span class="p">,</span> <span class="n">currentPhi</span><span class="p">,</span> <span class="n">current_angleofincidence</span>
                        <span class="p">)</span>

                    <span class="n">bsdfData_output_block</span><span class="p">[</span><span class="n">index_theta</span><span class="p">][</span><span class="n">index_phi</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_new_value_matrix</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span><span class="p">[</span><span class="n">index_block</span><span class="p">],</span> <span class="n">line_theta_input</span><span class="p">,</span> <span class="n">line_phi_input</span><span class="p">,</span> <span class="n">newTheta</span><span class="p">,</span> <span class="n">newPhi</span>
                    <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span><span class="p">[</span><span class="n">index_block</span><span class="p">]</span> <span class="o">=</span> <span class="n">bsdfData_output_block</span>
            <span class="n">index_block</span> <span class="o">=</span> <span class="n">index_block</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span> <span class="o">=</span> <span class="n">line_theta_output_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span> <span class="o">=</span> <span class="n">line_phi_output_list</span></div>

<div class="viewcode-block" id="BsdfStructure.normalize_bsdf_data"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.normalize_bsdf_data">[docs]</a>    <span class="k">def</span> <span class="nf">normalize_bsdf_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bool_log</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        That function normalizes the BSDF data vs the TIS values</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing normalization...&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nbSampleRotation nbAngleIncidence IntegralValue IntegralError Zemax_TIS_value NormalizationFactor&quot;</span><span class="p">)</span>

        <span class="c1"># Initialization</span>
        <span class="n">normalizationBsdf</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">index_block</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_incidence</span><span class="p">)):</span>
            <span class="n">block_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span><span class="p">[</span><span class="n">index_block</span><span class="p">])</span>

            <span class="n">theta_rad</span><span class="p">,</span> <span class="n">phi_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>  <span class="c1"># samples on which integrande is known</span>
            <span class="n">integrande</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">block_data</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span>
            <span class="p">)</span>  <span class="c1"># *theta for polar integration</span>
            <span class="c1"># Linear interpolation of the values</span>
            <span class="c1"># interp2d is apparently deprecated</span>
            <span class="c1"># Look for alternatives f = interpolate.bisplrep(theta_rad, phi_rad, integrande)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">,</span> <span class="n">phi_rad</span><span class="p">,</span> <span class="n">integrande</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># calculation of the integral</span>
            <span class="c1"># r = nquad(f, [[0, math.pi / 2], [0, 2 * math.pi]], opts=[{&quot;epsabs&quot;: 0.1}, {&quot;epsabs&quot;: 0.1}])</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">nquad</span><span class="p">(</span>
                <span class="n">f</span><span class="p">,</span>
                <span class="p">[[</span><span class="nb">min</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)],</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">phi_rad</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">phi_rad</span><span class="p">)]],</span>
                <span class="n">opts</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;epsabs&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;epsabs&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}],</span>
            <span class="p">)</span>
            <span class="n">IntegralValue</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">IntegralError</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Normalization of the data</span>
            <span class="k">if</span> <span class="n">IntegralValue</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">normalizationBsdf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_tisdata</span><span class="p">[</span><span class="n">index_block</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">IntegralValue</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">normalizationBsdf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integral &lt;= 0!!!!&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_samplerotation</span><span class="p">[</span><span class="n">index_block</span><span class="p">],</span>
                    <span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_incidence</span><span class="p">[</span><span class="n">index_block</span><span class="p">],</span>
                    <span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="nb">round</span><span class="p">(</span><span class="n">IntegralValue</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                    <span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="nb">round</span><span class="p">(</span><span class="n">IntegralError</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                    <span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_tisdata</span><span class="p">[</span><span class="n">index_block</span><span class="p">],</span>
                    <span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="nb">round</span><span class="p">(</span><span class="n">normalizationBsdf</span><span class="p">[</span><span class="n">index_block</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span><span class="p">[</span><span class="n">index_block</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span><span class="p">[</span><span class="n">index_block</span><span class="p">]</span> <span class="o">*</span> <span class="n">normalizationBsdf</span><span class="p">[</span><span class="n">index_block</span><span class="p">]</span>
            <span class="n">index_block</span> <span class="o">=</span> <span class="n">index_block</span> <span class="o">+</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="BsdfStructure.calculate_tis_data"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.calculate_tis_data">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_tis_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bool_log</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        That function computes the TIS values from the BSDF data and one TIS value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing normalization...&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nbSampleRotation nbAngleIncidence IntegralValue IntegralError Zemax_TIS_value&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index_block</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_incidence</span><span class="p">)):</span>
            <span class="n">block_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span><span class="p">[</span><span class="n">index_block</span><span class="p">])</span>

            <span class="n">theta_rad</span><span class="p">,</span> <span class="n">phi_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">[</span><span class="n">index_block</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span><span class="p">[</span><span class="n">index_block</span><span class="p">]</span>
            <span class="p">)</span>  <span class="c1"># samples on which integrande is known</span>
            <span class="n">integrande</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">block_data</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span>
            <span class="p">)</span>  <span class="c1"># *theta for polar integration</span>
            <span class="c1"># Linear interpolation of the values</span>
            <span class="c1"># interp2d is apparently deprecated</span>
            <span class="c1"># Look for alternatives f = interpolate.bisplrep(theta_rad, phi_rad, integrande)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">,</span> <span class="n">phi_rad</span><span class="p">,</span> <span class="n">integrande</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># calculation of the integral</span>
            <span class="c1"># r = nquad(f, [[0, math.pi / 2], [0, 2 * math.pi]], opts=[{&quot;epsabs&quot;: 0.1}, {&quot;epsabs&quot;: 0.1}])</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">nquad</span><span class="p">(</span>
                <span class="n">f</span><span class="p">,</span>
                <span class="p">[[</span><span class="nb">min</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)],</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">phi_rad</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">phi_rad</span><span class="p">)]],</span>
                <span class="n">opts</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;epsabs&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;epsabs&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}],</span>
            <span class="p">)</span>
            <span class="n">IntegralValue</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">IntegralError</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">index_block</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tis_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_tisdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">normalization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_tisdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">IntegralValue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tis_value</span> <span class="o">=</span> <span class="n">IntegralValue</span> <span class="o">*</span> <span class="n">normalization</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_tisdata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tis_value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bool_log</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_samplerotation</span><span class="p">[</span><span class="n">index_block</span><span class="p">],</span>
                    <span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_incidence</span><span class="p">[</span><span class="n">index_block</span><span class="p">],</span>
                    <span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="nb">round</span><span class="p">(</span><span class="n">IntegralValue</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                    <span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="nb">round</span><span class="p">(</span><span class="n">IntegralError</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                    <span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_tisdata</span><span class="p">[</span><span class="n">index_block</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="n">index_block</span> <span class="o">=</span> <span class="n">index_block</span> <span class="o">+</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="BsdfStructure.write_zemax_file"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.write_zemax_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_zemax_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bool_log</span><span class="p">):</span>
        <span class="c1"># Writing a Zemax file for each wavelength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">converter_coordinate_system_bsdf</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bool_log</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Writing a Zemax file for each wavelength</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Writing Zemax data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index_RT</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scattertype</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">index_wavelength</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)):</span>
                <span class="n">nLines_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_zemax_header_bsdf</span><span class="p">(</span><span class="n">index_RT</span><span class="p">,</span> <span class="n">index_wavelength</span><span class="p">)</span>
                <span class="n">nLines_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_zemax_data_bsdf</span><span class="p">(</span><span class="n">index_RT</span><span class="p">,</span> <span class="n">index_wavelength</span><span class="p">)</span>

                <span class="c1"># Writing Zemax file content (nLines) in a file</span>
                <span class="n">outputFilepath</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_input</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">index_wavelength</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scattertype</span><span class="p">[</span><span class="n">index_RT</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot;.bsdf&quot;</span>
                <span class="p">)</span>
                <span class="n">write_file</span><span class="p">(</span><span class="n">outputFilepath</span><span class="p">,</span> <span class="n">nLines_header</span> <span class="o">+</span> <span class="n">nLines_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="BsdfStructure.write_zemax_header_bsdf"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.write_zemax_header_bsdf">[docs]</a>    <span class="k">def</span> <span class="nf">write_zemax_header_bsdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_RT</span><span class="p">,</span> <span class="n">index_wavelength</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        That function writes the header of Zemax BSDF file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Header</span>
        <span class="n">nLines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#Data converted from Speos data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="c1"># Wavelength</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="s2">&quot;#Wavelength (nm) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">index_wavelength</span><span class="p">])</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Source</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="s2">&quot;Source  Measured&quot;</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Symmetry</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Symmetry  &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># SpectralContent</span>
        <span class="n">spectralcontent</span> <span class="o">=</span> <span class="s2">&quot;SpectralContent  Monochrome&quot;</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">spectralcontent</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># ScatterType</span>
        <span class="n">ScatterType</span> <span class="o">=</span> <span class="s2">&quot;ScatterType  &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scattertype</span><span class="p">[</span><span class="n">index_RT</span><span class="p">])</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ScatterType</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># SampleRotation</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SampleRotation  &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplerotation</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># List of SampleRotation</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplerotation</span><span class="p">)):</span>
            <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplerotation</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># AngleOfIncidence</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;AngleOfIncidence  &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incidence</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># List of AngleOfIncidence</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incidence</span><span class="p">)):</span>
            <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incidence</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># List of ScatterAzimuth</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ScatterAzimuth &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span><span class="p">)):</span>
            <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># List of ScatterRadial</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ScatterRadial &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">)):</span>
            <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># A few more lines</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Monochrome</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;DataBegin</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">nLines</span></div>

<div class="viewcode-block" id="BsdfStructure.write_zemax_data_bsdf"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.write_zemax_data_bsdf">[docs]</a>    <span class="k">def</span> <span class="nf">write_zemax_data_bsdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_RT</span><span class="p">,</span> <span class="n">index_wavelength</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        That function writes the main data of Zemax BSDF file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nLines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nb_angleofincidence</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incidence</span><span class="p">)</span>
        <span class="n">nb_wavelength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="n">nb_samplerotation</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplerotation</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index_samplerotation</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplerotation</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">index_angleofincidence</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incidence</span><span class="p">)):</span>
                <span class="n">index_data</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">index_RT</span> <span class="o">*</span> <span class="n">nb_wavelength</span> <span class="o">*</span> <span class="n">nb_samplerotation</span>
                    <span class="o">+</span> <span class="n">index_wavelength</span> <span class="o">*</span> <span class="n">nb_samplerotation</span>
                    <span class="o">+</span> <span class="n">index_samplerotation</span>
                <span class="p">)</span> <span class="o">*</span> <span class="n">nb_angleofincidence</span> <span class="o">+</span> <span class="n">index_angleofincidence</span>
                <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;TIS &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_tisdata</span><span class="p">[</span><span class="n">index_data</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">index_phi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">index_theta</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">scientific_notation</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.3e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span><span class="p">[</span><span class="n">index_data</span><span class="p">][</span><span class="n">index_theta</span><span class="p">][</span><span class="n">index_phi</span><span class="p">])</span>
                        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">scientific_notation</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">index_theta</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">scientific_notation</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.3e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span><span class="p">[</span><span class="n">index_data</span><span class="p">][</span><span class="n">index_theta</span><span class="p">][</span><span class="n">index_phi</span><span class="p">])</span>
                    <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">scientific_notation</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;DataEnd</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">nLines</span></div>

<div class="viewcode-block" id="BsdfStructure.write_speos_anisotropicbsdf_file"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.write_speos_anisotropicbsdf_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_speos_anisotropicbsdf_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Writing a Speos file</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Writing Speos data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">nLines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_speos_header_anisotropicbsdf</span><span class="p">()</span>
        <span class="n">nLines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_speos_data_anisotropicbsdf</span><span class="p">(</span><span class="n">nLines</span><span class="p">)</span>
        <span class="n">outputFilepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_input</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.anisotropicbsdf&quot;</span>
        <span class="n">write_file</span><span class="p">(</span><span class="n">outputFilepath</span><span class="p">,</span> <span class="n">nLines</span><span class="p">)</span></div>

<div class="viewcode-block" id="BsdfStructure.write_speos_header_anisotropicbsdf"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.write_speos_header_anisotropicbsdf">[docs]</a>    <span class="k">def</span> <span class="nf">write_speos_header_anisotropicbsdf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        That function writes the header of Speos BSDF file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nbSampleRotation</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplerotation</span><span class="p">)</span>
        <span class="n">nbAngleIncidence</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incidence</span><span class="p">)</span>
        <span class="n">binaryMode</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">anisotropyVector</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="n">measurementDescription</span> <span class="o">=</span> <span class="s2">&quot;Measurement description&quot;</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="s2">&quot;Comment&quot;</span>

        <span class="c1"># Header</span>
        <span class="n">nLines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;OPTIS - Anisotropic BSDF surface file v7.0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="c1"># Binary mode</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">binaryMode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Comment</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comment</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Measurement description</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">measurementDescription</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measurementDescription</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Anisotropy vector</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">anisotropyVector</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">anisotropyVector</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">anisotropyVector</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Scatter type (BRDF/BTDF)</span>
        <span class="c1"># Type of values</span>
        <span class="c1"># 1 means the data is proportional to the BSDF data</span>
        <span class="c1"># 0 means the data is proportional to the measured intensity</span>
        <span class="c1"># For BTDF: valuesType = 0 because of a bug</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattertype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BRDF&quot;</span><span class="p">:</span>
            <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;1&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">valuesType</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">valuesType</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattertype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BTDF&quot;</span><span class="p">:</span>
            <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;1&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">valuesType</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">valuesType</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.....WARNING: Original data file has no valid ScatterType&quot;</span><span class="p">)</span>
            <span class="c1"># tempVariable = input(&quot;.....Press Enter to continue&quot;)</span>
        <span class="c1"># Anisotropy angles (SampleRotations)</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nbSampleRotation</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbSampleRotation</span><span class="p">):</span>
            <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_samplerotation</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nbSampleRotation</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Incident angles (AngleIncidence)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbSampleRotation</span><span class="p">):</span>
            <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nbAngleIncidence</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbAngleIncidence</span><span class="p">):</span>
                <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_incidence</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nbAngleIncidence</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># theta and phi for measurement</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_incidence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Spectrum description</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Number of wavelength</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;2&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Wavelength measurements</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;350&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_tisdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;850&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_tisdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">nLines</span></div>

<div class="viewcode-block" id="BsdfStructure.write_speos_data_anisotropicbsdf"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.write_speos_data_anisotropicbsdf">[docs]</a>    <span class="k">def</span> <span class="nf">write_speos_data_anisotropicbsdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nLines</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        That function writes the main data of Speos BSDF file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">nbtheta</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">)</span>
        <span class="n">nbphi</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span><span class="p">)</span>
        <span class="n">index_block</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># If transmission data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattertype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BTDF&quot;</span><span class="p">:</span>
            <span class="c1"># change line theta from 90--&gt; 180 to 0--&gt;90</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span>
            <span class="n">temp_180</span> <span class="o">=</span> <span class="p">[</span><span class="mi">180</span> <span class="o">-</span> <span class="n">temp</span><span class="p">[</span><span class="n">index_theta</span><span class="p">]</span> <span class="k">for</span> <span class="n">index_theta</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span> <span class="o">=</span> <span class="n">temp_180</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># if self.scattertype[0] == &quot;BTDF&quot;:</span>
        <span class="c1"># bsdfData_output = bsdfData_output_temp</span>
        <span class="c1"># else:</span>
        <span class="c1">#    for i in range(nblistDimension1):</span>
        <span class="c1">#        for j in range(nblistDimension2):</span>
        <span class="c1">#            for k in range(len(line_theta_output)):</span>
        <span class="c1">#                bsdfData_output[i][j][k] = bsdfData_output_temp[i][j][len(line_theta_output) - 1 - k]</span>

        <span class="k">for</span> <span class="n">index_samplerotation</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplerotation</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">index_incidence</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incidence</span><span class="p">)):</span>
                <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nbtheta</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nbphi</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Write the 1st line of the block with the Phi values</span>
                <span class="k">for</span> <span class="n">index_phi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbphi</span><span class="p">):</span>
                    <span class="n">currentPhi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_phi</span><span class="p">[</span><span class="n">index_phi</span><span class="p">]</span>
                    <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">currentPhi</span><span class="p">))</span>
                <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattertype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BTDF&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span><span class="p">[</span><span class="n">index_block</span><span class="p">]</span> <span class="o">=</span> <span class="n">swap_rows</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span><span class="p">[</span><span class="n">index_block</span><span class="p">])</span>

                <span class="k">for</span> <span class="n">index_theta</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbtheta</span><span class="p">):</span>
                    <span class="n">currentTheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata_theta</span><span class="p">[</span><span class="n">index_theta</span><span class="p">]</span>
                    <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">currentTheta</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">index_phi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbphi</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattertype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BRDF&quot;</span><span class="p">:</span>
                            <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span><span class="p">[</span><span class="n">index_block</span><span class="p">][</span><span class="n">index_theta</span><span class="p">][</span><span class="n">index_phi</span><span class="p">]))</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattertype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BTDF&quot;</span><span class="p">:</span>
                            <span class="n">thetas_cosine</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="mi">180</span> <span class="o">-</span> <span class="n">currentTheta</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
                            <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">thetas_cosine</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsdfdata</span><span class="p">[</span><span class="n">index_block</span><span class="p">][</span><span class="n">index_theta</span><span class="p">][</span><span class="n">index_phi</span><span class="p">])</span>
                            <span class="p">)</span>
                    <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">index_block</span> <span class="o">=</span> <span class="n">index_block</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;End of file&quot;</span><span class="p">)</span>
        <span class="n">nLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">nLines</span></div>

<div class="viewcode-block" id="BsdfStructure.convert_rgb_to_spectrum_value"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.convert_rgb_to_spectrum_value">[docs]</a>    <span class="k">def</span> <span class="nf">convert_rgb_to_spectrum_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rgb_tuple</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function to convert an RGB tuple to a spectrum</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wavelength: float</span>
<span class="sd">            wavelength of conversion</span>
<span class="sd">        rgb_tuple: tuple</span>
<span class="sd">            3 floats of RGB</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        spectrumvalue at wavelength: floats</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">r</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">rgb_tuple</span>
        <span class="n">red_spectral_representation</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mf">1.28</span><span class="p">,</span>
            <span class="mf">1.28</span><span class="p">,</span>
            <span class="mf">1.28</span><span class="p">,</span>
            <span class="mf">1.28</span><span class="p">,</span>
            <span class="mf">1.28</span><span class="p">,</span>
            <span class="mf">1.28</span><span class="p">,</span>
            <span class="mf">1.28</span><span class="p">,</span>
            <span class="mf">1.28</span><span class="p">,</span>
            <span class="mf">1.28</span><span class="p">,</span>
            <span class="mf">1.28</span><span class="p">,</span>
            <span class="mf">1.28</span><span class="p">,</span>
            <span class="mf">1.28</span><span class="p">,</span>
            <span class="mf">1.28</span><span class="p">,</span>
            <span class="mf">1.28</span><span class="p">,</span>
            <span class="mf">1.29</span><span class="p">,</span>
            <span class="mf">1.3</span><span class="p">,</span>
            <span class="mf">1.34</span><span class="p">,</span>
            <span class="mf">1.44</span><span class="p">,</span>
            <span class="mf">1.7</span><span class="p">,</span>
            <span class="mf">2.27</span><span class="p">,</span>
            <span class="mf">3.48</span><span class="p">,</span>
            <span class="mf">5.81</span><span class="p">,</span>
            <span class="mf">9.93</span><span class="p">,</span>
            <span class="mf">16.6</span><span class="p">,</span>
            <span class="mf">26.4</span><span class="p">,</span>
            <span class="mf">39.4</span><span class="p">,</span>
            <span class="mi">55</span><span class="p">,</span>
            <span class="mf">71.4</span><span class="p">,</span>
            <span class="mf">86.1</span><span class="p">,</span>
            <span class="mf">96.3</span><span class="p">,</span>
            <span class="mi">100</span><span class="p">,</span>
            <span class="mf">96.3</span><span class="p">,</span>
            <span class="mf">86.1</span><span class="p">,</span>
            <span class="mf">71.4</span><span class="p">,</span>
            <span class="mi">55</span><span class="p">,</span>
            <span class="mf">39.4</span><span class="p">,</span>
            <span class="mf">26.4</span><span class="p">,</span>
            <span class="mf">16.6</span><span class="p">,</span>
            <span class="mf">9.93</span><span class="p">,</span>
            <span class="mf">5.81</span><span class="p">,</span>
            <span class="mf">3.48</span><span class="p">,</span>
            <span class="mf">2.27</span><span class="p">,</span>
            <span class="mf">1.7</span><span class="p">,</span>
            <span class="mf">1.44</span><span class="p">,</span>
            <span class="mf">1.34</span><span class="p">,</span>
            <span class="mf">1.3</span><span class="p">,</span>
            <span class="mf">1.29</span><span class="p">,</span>
            <span class="mf">1.28</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">green_spectral_representation</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mf">4.13245e-05</span><span class="p">,</span>
            <span class="mf">0.000203619</span><span class="p">,</span>
            <span class="mf">0.000915526</span><span class="p">,</span>
            <span class="mf">0.00375632</span><span class="p">,</span>
            <span class="mf">0.0140636</span><span class="p">,</span>
            <span class="mf">0.0480473</span><span class="p">,</span>
            <span class="mf">0.14979</span><span class="p">,</span>
            <span class="mf">0.426124</span><span class="p">,</span>
            <span class="mf">1.10619</span><span class="p">,</span>
            <span class="mf">2.62039</span><span class="p">,</span>
            <span class="mf">5.66423</span><span class="p">,</span>
            <span class="mf">11.1727</span><span class="p">,</span>
            <span class="mf">20.11</span><span class="p">,</span>
            <span class="mf">33.0301</span><span class="p">,</span>
            <span class="mf">49.5047</span><span class="p">,</span>
            <span class="mf">67.7056</span><span class="p">,</span>
            <span class="mf">84.4972</span><span class="p">,</span>
            <span class="mf">96.2279</span><span class="p">,</span>
            <span class="mi">100</span><span class="p">,</span>
            <span class="mf">94.8286</span><span class="p">,</span>
            <span class="mf">82.0577</span><span class="p">,</span>
            <span class="mf">64.7947</span><span class="p">,</span>
            <span class="mf">46.6875</span><span class="p">,</span>
            <span class="mf">30.6974</span><span class="p">,</span>
            <span class="mf">18.418</span><span class="p">,</span>
            <span class="mf">10.0838</span><span class="p">,</span>
            <span class="mf">5.03789</span><span class="p">,</span>
            <span class="mf">2.29674</span><span class="p">,</span>
            <span class="mf">0.955466</span><span class="p">,</span>
            <span class="mf">0.36271</span><span class="p">,</span>
            <span class="mf">0.125645</span><span class="p">,</span>
            <span class="mf">0.0397163</span><span class="p">,</span>
            <span class="mf">0.011456</span><span class="p">,</span>
            <span class="mf">0.00301537</span><span class="p">,</span>
            <span class="mf">0.000724246</span><span class="p">,</span>
            <span class="mf">0.000158735</span><span class="p">,</span>
            <span class="mf">3.17468e-05</span><span class="p">,</span>
            <span class="mf">5.79386e-06</span><span class="p">,</span>
            <span class="mf">9.64886e-07</span><span class="p">,</span>
            <span class="mf">1.46631e-07</span><span class="p">,</span>
            <span class="mf">2.03336e-08</span><span class="p">,</span>
            <span class="mf">2.57302e-09</span><span class="p">,</span>
            <span class="mf">2.97107e-10</span><span class="p">,</span>
            <span class="mf">3.13057e-11</span><span class="p">,</span>
            <span class="mf">3.01006e-12</span><span class="p">,</span>
            <span class="mf">2.64099e-13</span><span class="p">,</span>
            <span class="mf">2.11445e-14</span><span class="p">,</span>
            <span class="mf">1.54479e-15</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">blue_spectral_representation</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mf">1.36</span><span class="p">,</span>
            <span class="mf">2.27</span><span class="p">,</span>
            <span class="mf">4.57</span><span class="p">,</span>
            <span class="mf">9.61</span><span class="p">,</span>
            <span class="mi">19</span><span class="p">,</span>
            <span class="mf">34.1</span><span class="p">,</span>
            <span class="mf">54.1</span><span class="p">,</span>
            <span class="mf">75.6</span><span class="p">,</span>
            <span class="mf">92.8</span><span class="p">,</span>
            <span class="mi">100</span><span class="p">,</span>
            <span class="mf">94.5</span><span class="p">,</span>
            <span class="mf">78.4</span><span class="p">,</span>
            <span class="mf">57.1</span><span class="p">,</span>
            <span class="mf">36.6</span><span class="p">,</span>
            <span class="mf">20.8</span><span class="p">,</span>
            <span class="mf">10.6</span><span class="p">,</span>
            <span class="mf">5.07</span><span class="p">,</span>
            <span class="mf">2.48</span><span class="p">,</span>
            <span class="mf">1.44</span><span class="p">,</span>
            <span class="mf">1.08</span><span class="p">,</span>
            <span class="mf">0.97</span><span class="p">,</span>
            <span class="mf">0.942</span><span class="p">,</span>
            <span class="mf">0.935</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
            <span class="mf">0.934</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span>
                <span class="n">r</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_srgb_spectrum_at_wavelength</span><span class="p">(</span><span class="n">red_spectral_representation</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">,</span> <span class="mf">830.0</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_srgb_spectrum_at_wavelength</span><span class="p">(</span><span class="n">green_spectral_representation</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">,</span> <span class="mf">830.0</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_srgb_spectrum_at_wavelength</span><span class="p">(</span><span class="n">blue_spectral_representation</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">,</span> <span class="mf">830.0</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mf">100.0</span>
<div class="viewcode-block" id="BsdfStructure.get_srgb_spectrum_at_wavelength"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.BsdfStructure.get_srgb_spectrum_at_wavelength">[docs]</a>            <span class="o">@</span> <span class="nb">staticmethod</span>
        <span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_srgb_spectrum_at_wavelength</span><span class="p">(</span><span class="n">conversion_spectrum</span><span class="p">,</span> <span class="n">wl_start</span><span class="p">,</span> <span class="n">wl_end</span><span class="p">,</span> <span class="n">wl</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to extrapolar</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        conversion_spectrum: list</span>
<span class="sd">            Spectrum data in % values 0-100</span>
<span class="sd">        wl_start: float</span>
<span class="sd">            start wavelength in nm</span>
<span class="sd">        wl_end: float</span>
<span class="sd">            end wavelength in nm</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        spectrum value in % 0-100</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">interval_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">conversion_spectrum</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">lambda_increment</span> <span class="o">=</span> <span class="p">(</span><span class="n">wl_end</span> <span class="o">-</span> <span class="n">wl_start</span><span class="p">)</span> <span class="o">/</span> <span class="n">interval_items</span>
        <span class="k">if</span> <span class="n">wl</span> <span class="o">&lt;=</span> <span class="n">wl_start</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">conversion_spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">wl</span> <span class="o">&gt;=</span> <span class="n">wl_end</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">conversion_spectrum</span><span class="p">[</span><span class="n">interval_items</span><span class="p">]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">wl</span> <span class="o">-</span> <span class="n">wl_start</span><span class="p">)</span> <span class="o">/</span> <span class="n">lambda_increment</span>
        <span class="n">pos_integer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">pos_fractional</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">-</span> <span class="n">pos</span>
        <span class="n">slope</span> <span class="o">=</span> <span class="n">conversion_spectrum</span><span class="p">[</span><span class="n">pos_integer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">conversion_spectrum</span><span class="p">[</span><span class="n">pos_integer</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">conversion_spectrum</span><span class="p">[</span><span class="n">pos_integer</span><span class="p">]</span> <span class="o">+</span> <span class="n">pos_fractional</span> <span class="o">*</span> <span class="n">slope</span></div></div>


<div class="viewcode-block" id="convert_normal_to_specular_using_cartesian"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.convert_normal_to_specular_using_cartesian">[docs]</a><span class="k">def</span> <span class="nf">convert_normal_to_specular_using_cartesian</span><span class="p">(</span><span class="n">theta_i</span><span class="p">,</span> <span class="n">phi_i</span><span class="p">,</span> <span class="n">angle_inc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    That function converts from normal to specular reference using cartesian coordinates</span>
<span class="sd">    phi_i = 0 in the normal reference = phi_o = 180 in the specular reference</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta_i : float</span>
<span class="sd">        Scattered polar angle in the normal reference</span>
<span class="sd">    phi_i : float</span>
<span class="sd">        Scattered azimuthal angle in the normal reference</span>
<span class="sd">    angle_inc : float</span>
<span class="sd">        Angle of incidence</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># spherical coordinates in normal reference</span>
    <span class="n">theta_i</span> <span class="o">*=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
    <span class="n">phi_i</span> <span class="o">*=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
    <span class="c1"># Conversion to cartesian coordinates</span>
    <span class="n">x_i</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_i</span><span class="p">)</span>
    <span class="n">y_i</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_i</span><span class="p">)</span>
    <span class="n">z_i</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_i</span><span class="p">)</span>
    <span class="c1"># Conversion to new specular cartesian coordinates</span>
    <span class="n">x_o</span> <span class="o">=</span> <span class="n">x_i</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_inc</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">-</span> <span class="n">z_i</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_inc</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
    <span class="n">y_o</span> <span class="o">=</span> <span class="n">y_i</span>
    <span class="n">z_o</span> <span class="o">=</span> <span class="n">x_i</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_inc</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">+</span> <span class="n">z_i</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_inc</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
    <span class="c1"># Normalization</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x_o</span> <span class="o">*</span> <span class="n">x_o</span> <span class="o">+</span> <span class="n">y_o</span> <span class="o">*</span> <span class="n">y_o</span> <span class="o">+</span> <span class="n">z_o</span> <span class="o">*</span> <span class="n">z_o</span><span class="p">)</span>
    <span class="n">x_o</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">norm</span>
    <span class="n">y_o</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">norm</span>
    <span class="n">z_o</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">norm</span>
    <span class="c1"># Conversion to new spherical coordinates</span>
    <span class="n">theta_o</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">z_o</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x_o</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">y_o</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">y_o</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="k">if</span> <span class="n">y_o</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">270</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">phi_o</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">y_o</span> <span class="o">/</span> <span class="n">x_o</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x_o</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">+</span> <span class="n">phi_o</span>
        <span class="k">if</span> <span class="n">x_o</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y_o</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">+</span> <span class="n">phi_o</span>

    <span class="c1"># added lines to change phi ref</span>
    <span class="k">if</span> <span class="n">phi_o</span> <span class="o">&lt;</span> <span class="mi">180</span><span class="p">:</span>
        <span class="n">phi_o</span> <span class="o">=</span> <span class="n">phi_o</span> <span class="o">+</span> <span class="mi">180</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">phi_o</span> <span class="o">=</span> <span class="n">phi_o</span> <span class="o">-</span> <span class="mi">180</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">theta_o</span><span class="p">,</span> <span class="n">phi_o</span><span class="p">)</span></div>


<div class="viewcode-block" id="convert_specular_to_normal_using_cartesian"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.convert_specular_to_normal_using_cartesian">[docs]</a><span class="k">def</span> <span class="nf">convert_specular_to_normal_using_cartesian</span><span class="p">(</span><span class="n">theta_i</span><span class="p">,</span> <span class="n">phi_i</span><span class="p">,</span> <span class="n">angle_inc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    That function converts from specular to normal reference using cartesian coordinates</span>
<span class="sd">    Specular reference: phi = 0 top of the plot</span>
<span class="sd">    Normal reference: phi = 0 bottom of the plot</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta_i : float</span>
<span class="sd">        Scattered polar angle in the specular reference</span>
<span class="sd">    phi_i : float</span>
<span class="sd">        Scattered azimuthal angle in the specular reference</span>
<span class="sd">    angle_inc : float</span>
<span class="sd">        Angle of incidence</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># spherical coordinates in normal reference</span>
    <span class="n">theta_i</span> <span class="o">*=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
    <span class="n">phi_i</span> <span class="o">*=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
    <span class="c1"># Conversion to cartesian coordinates</span>
    <span class="n">x_i</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_i</span><span class="p">)</span>
    <span class="n">y_i</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_i</span><span class="p">)</span>
    <span class="n">z_i</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_i</span><span class="p">)</span>
    <span class="c1"># Conversion to new normal cartesian coordinates</span>
    <span class="n">x_o</span> <span class="o">=</span> <span class="o">-</span><span class="n">x_i</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_inc</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">+</span> <span class="n">z_i</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_inc</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>  <span class="c1"># to check</span>
    <span class="n">y_o</span> <span class="o">=</span> <span class="n">y_i</span>
    <span class="n">z_o</span> <span class="o">=</span> <span class="n">x_i</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_inc</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">+</span> <span class="n">z_i</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_inc</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>  <span class="c1"># to check</span>
    <span class="c1"># Normalization</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x_o</span> <span class="o">*</span> <span class="n">x_o</span> <span class="o">+</span> <span class="n">y_o</span> <span class="o">*</span> <span class="n">y_o</span> <span class="o">+</span> <span class="n">z_o</span> <span class="o">*</span> <span class="n">z_o</span><span class="p">)</span>
    <span class="n">x_o</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">norm</span>
    <span class="n">y_o</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">norm</span>
    <span class="n">z_o</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">norm</span>
    <span class="c1"># Conversion to new spherical coordinates</span>
    <span class="n">theta_o</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">z_o</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">x_o</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">y_o</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="n">phi_i</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y_o</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">270</span>
        <span class="k">if</span> <span class="n">y_o</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">90</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">phi_o</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y_o</span><span class="p">,</span> <span class="n">x_o</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">y_o</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">phi_o</span>

    <span class="n">theta_o</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">theta_o</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">phi_o</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">phi_o</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">theta_o</span><span class="p">,</span> <span class="n">phi_o</span><span class="p">)</span></div>


<div class="viewcode-block" id="convert_normal_to_specular_using_cylindrical"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.convert_normal_to_specular_using_cylindrical">[docs]</a><span class="k">def</span> <span class="nf">convert_normal_to_specular_using_cylindrical</span><span class="p">(</span><span class="n">theta_i</span><span class="p">,</span> <span class="n">phi_i</span><span class="p">,</span> <span class="n">angle_inc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    That function converts from normal to specular reference using cylindrical cartesian conversion</span>
<span class="sd">    phi = 0 top of the plot</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta_i : float</span>
<span class="sd">        Scattered polar angle in the normal reference</span>
<span class="sd">    phi_i : float</span>
<span class="sd">        Scattered azimuthal angle in the normal reference</span>
<span class="sd">    angle_inc : float</span>
<span class="sd">        Angle of incidence</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># cylindrical coordinates</span>
    <span class="c1"># theta_i*=math.pi/180</span>
    <span class="n">phi_i</span> <span class="o">*=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
    <span class="c1"># Conversion to cartesian coordinates</span>
    <span class="n">x_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_i</span><span class="p">)</span>
    <span class="n">y_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_i</span><span class="p">)</span>
    <span class="c1"># Conversion to new cartesian coordinates</span>
    <span class="n">x_o</span> <span class="o">=</span> <span class="n">x_i</span> <span class="o">-</span> <span class="n">angle_inc</span>
    <span class="n">y_o</span> <span class="o">=</span> <span class="n">y_i</span>
    <span class="c1"># Conversion to new cylindrical coordinates</span>
    <span class="n">theta_o</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x_o</span> <span class="o">*</span> <span class="n">x_o</span> <span class="o">+</span> <span class="n">y_o</span> <span class="o">*</span> <span class="n">y_o</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x_o</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">y_o</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">y_o</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="k">if</span> <span class="n">y_o</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">270</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">phi_o</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">y_o</span> <span class="o">/</span> <span class="n">x_o</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x_o</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">+</span> <span class="n">phi_o</span>
        <span class="k">if</span> <span class="n">x_o</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y_o</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">+</span> <span class="n">phi_o</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">theta_o</span><span class="p">,</span> <span class="n">phi_o</span><span class="p">)</span></div>


<div class="viewcode-block" id="convert_normal_to_specular_using_cylindrical_phiref"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.convert_normal_to_specular_using_cylindrical_phiref">[docs]</a><span class="k">def</span> <span class="nf">convert_normal_to_specular_using_cylindrical_phiref</span><span class="p">(</span><span class="n">theta_i</span><span class="p">,</span> <span class="n">phi_i</span><span class="p">,</span> <span class="n">angle_inc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    That function converts from normal to specular reference using cylindrical cartesian conversion</span>
<span class="sd">    phi=0 for OpticStudio is phi=180 for speos</span>
<span class="sd">    phi = 0 top of the plot</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta_i : float</span>
<span class="sd">        Scattered polar angle in the normal reference</span>
<span class="sd">    phi_i : float</span>
<span class="sd">        Scattered azimuthal angle in the normal reference</span>
<span class="sd">    angle_inc : float</span>
<span class="sd">        Angle of incidence</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># cylindrical coordinates</span>
    <span class="c1"># theta_i*=math.pi/180</span>
    <span class="n">phi_i</span> <span class="o">*=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
    <span class="c1"># Conversion to cartesian coordinates</span>
    <span class="n">x_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_i</span><span class="p">)</span>
    <span class="n">y_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_i</span><span class="p">)</span>
    <span class="c1"># Conversion to new cartesian coordinates</span>
    <span class="n">x_o</span> <span class="o">=</span> <span class="n">x_i</span> <span class="o">-</span> <span class="n">angle_inc</span>
    <span class="n">y_o</span> <span class="o">=</span> <span class="n">y_i</span>
    <span class="c1"># Conversion to new cylindrical coordinates</span>
    <span class="n">theta_o</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x_o</span> <span class="o">*</span> <span class="n">x_o</span> <span class="o">+</span> <span class="n">y_o</span> <span class="o">*</span> <span class="n">y_o</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x_o</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">y_o</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">y_o</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="k">if</span> <span class="n">y_o</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">270</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">phi_o</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">y_o</span> <span class="o">/</span> <span class="n">x_o</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x_o</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">+</span> <span class="n">phi_o</span>
        <span class="k">if</span> <span class="n">x_o</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y_o</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_o</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">+</span> <span class="n">phi_o</span>

    <span class="c1"># added lines to change phi ref</span>
    <span class="k">if</span> <span class="n">phi_o</span> <span class="o">&lt;</span> <span class="mi">180</span><span class="p">:</span>
        <span class="n">phi_o</span> <span class="o">=</span> <span class="n">phi_o</span> <span class="o">+</span> <span class="mi">180</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">phi_o</span> <span class="o">=</span> <span class="n">phi_o</span> <span class="o">-</span> <span class="mi">180</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">theta_o</span><span class="p">,</span> <span class="n">phi_o</span><span class="p">)</span></div>


<div class="viewcode-block" id="compute_new_value_matrix"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.compute_new_value_matrix">[docs]</a><span class="k">def</span> <span class="nf">compute_new_value_matrix</span><span class="p">(</span><span class="n">matrix_z</span><span class="p">,</span> <span class="n">line_x</span><span class="p">,</span> <span class="n">line_y</span><span class="p">,</span> <span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    That function takes (x,y) as an argument and returns a new interpolated value from a matrix[x,y]</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    matrix_z : matrix of z values</span>
<span class="sd">        matrix giving a z value for a set of x,y values</span>
<span class="sd">    line_x : list</span>
<span class="sd">        List of x</span>
<span class="sd">    line_y : list</span>
<span class="sd">        List of y</span>
<span class="sd">    new_x : flaot</span>
<span class="sd">        New value of theta</span>
<span class="sd">    new_y : flaot</span>
<span class="sd">        New value of phi</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">index_x</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">line_x</span><span class="p">,</span> <span class="n">new_x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">index_x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">indexInf_x</span> <span class="o">=</span> <span class="n">index_x</span>
        <span class="n">indexSup_x</span> <span class="o">=</span> <span class="n">index_x</span>
        <span class="n">coeff_x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">index_x</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line_x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Sandrine: added +1</span>
        <span class="n">indexInf_x</span> <span class="o">=</span> <span class="n">index_x</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">indexSup_x</span> <span class="o">=</span> <span class="n">index_x</span>
        <span class="n">x_Inf</span> <span class="o">=</span> <span class="n">line_x</span><span class="p">[</span><span class="n">indexInf_x</span><span class="p">]</span>
        <span class="n">x_Sup</span> <span class="o">=</span> <span class="n">line_x</span><span class="p">[</span><span class="n">indexSup_x</span><span class="p">]</span>
        <span class="n">coeff_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_x</span> <span class="o">-</span> <span class="n">x_Inf</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_Sup</span> <span class="o">-</span> <span class="n">x_Inf</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">newValue</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">newValue</span>
        <span class="c1"># index_x = len(line_x) - 1</span>
        <span class="c1"># indexInf_x = index_x</span>
        <span class="c1"># indexSup_x = index_x</span>
        <span class="c1"># coeff_x = 0</span>

    <span class="n">index_y</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">line_y</span><span class="p">,</span> <span class="n">new_y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">index_y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">indexInf_y</span> <span class="o">=</span> <span class="n">index_y</span>
        <span class="n">indexSup_y</span> <span class="o">=</span> <span class="n">index_y</span>
        <span class="n">coeff_y</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">index_y</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line_y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">indexInf_y</span> <span class="o">=</span> <span class="n">index_y</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">indexSup_y</span> <span class="o">=</span> <span class="n">index_y</span>
        <span class="n">y_Inf</span> <span class="o">=</span> <span class="n">line_y</span><span class="p">[</span><span class="n">indexInf_y</span><span class="p">]</span>
        <span class="n">y_Sup</span> <span class="o">=</span> <span class="n">line_y</span><span class="p">[</span><span class="n">indexSup_y</span><span class="p">]</span>
        <span class="n">coeff_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_y</span> <span class="o">-</span> <span class="n">y_Inf</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_Sup</span> <span class="o">-</span> <span class="n">y_Inf</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">newValue</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">newValue</span>
        <span class="c1"># index_y = len(line_y) - 1</span>
        <span class="c1"># indexInf_y = index_y</span>
        <span class="c1"># indexSup_y = index_y</span>
        <span class="c1"># coeff_y = 0</span>

    <span class="c1"># Linear interpolation</span>
    <span class="n">value_Inf_x</span> <span class="o">=</span> <span class="n">matrix_z</span><span class="p">[</span><span class="n">indexInf_x</span><span class="p">][</span><span class="n">indexInf_y</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">coeff_y</span><span class="p">)</span> <span class="o">+</span> <span class="n">matrix_z</span><span class="p">[</span><span class="n">indexInf_x</span><span class="p">][</span><span class="n">indexSup_y</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff_y</span>
    <span class="n">value_Sup_x</span> <span class="o">=</span> <span class="n">matrix_z</span><span class="p">[</span><span class="n">indexSup_x</span><span class="p">][</span><span class="n">indexInf_y</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">coeff_y</span><span class="p">)</span> <span class="o">+</span> <span class="n">matrix_z</span><span class="p">[</span><span class="n">indexSup_x</span><span class="p">][</span><span class="n">indexSup_y</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff_y</span>
    <span class="n">newValue</span> <span class="o">=</span> <span class="n">value_Inf_x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">coeff_x</span><span class="p">)</span> <span class="o">+</span> <span class="n">value_Sup_x</span> <span class="o">*</span> <span class="n">coeff_x</span>
    <span class="k">return</span> <span class="n">newValue</span></div>


<div class="viewcode-block" id="swap_columns"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.swap_columns">[docs]</a><span class="k">def</span> <span class="nf">swap_columns</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="n">arr_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">nb_columns</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">index_column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_columns</span><span class="p">):</span>
        <span class="n">arr_temp</span><span class="p">[:,</span> <span class="n">index_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,</span> <span class="n">nb_columns</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">index_column</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">arr_temp</span></div>


<div class="viewcode-block" id="swap_rows"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.swap_rows">[docs]</a><span class="k">def</span> <span class="nf">swap_rows</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="n">arr_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">nb_rows</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">index_row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_rows</span><span class="p">):</span>
        <span class="n">arr_temp</span><span class="p">[</span><span class="n">index_row</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">nb_rows</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">index_row</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">return</span> <span class="n">arr_temp</span></div>


<div class="viewcode-block" id="write_file"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.write_file">[docs]</a><span class="k">def</span> <span class="nf">write_file</span><span class="p">(</span><span class="n">outputFilepath</span><span class="p">,</span> <span class="n">nLines</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    That function writes the text nLines in the file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nLines : text</span>
<span class="sd">        Text containing the data</span>
<span class="sd">    outputFilepath : filename</span>
<span class="sd">        file to write</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFilepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">nFile</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">nLines</span><span class="p">)</span>
    <span class="n">nFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The file &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">outputFilepath</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; is ready!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="phi_theta_output"><a class="viewcode-back" href="../../../api/ansys_optical_automation.interop_process.html#ansys_optical_automation.interop_process.BSDF_converter.phi_theta_output">[docs]</a><span class="k">def</span> <span class="nf">phi_theta_output</span><span class="p">(</span><span class="n">theta_input</span><span class="p">,</span> <span class="n">phi_input</span><span class="p">,</span> <span class="n">zemax_or_speos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    That function writes the text nLines in the file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">theta_output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">phi_output</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Limitation</span>
    <span class="n">nbTheta_max</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">nbPhi_max</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="k">if</span> <span class="n">zemax_or_speos</span> <span class="o">==</span> <span class="s2">&quot;speos&quot;</span><span class="p">:</span>
        <span class="n">theta_max</span> <span class="o">=</span> <span class="mi">180</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">theta_max</span> <span class="o">=</span> <span class="mi">90</span>
    <span class="n">phi_max</span> <span class="o">=</span> <span class="mi">360</span>
    <span class="c1"># if bsdfstructure_input.symmetry == &quot;PlaneSymmetrical&quot;:</span>
    <span class="c1">#    phi_max = 180</span>
    <span class="c1">#    nbPhi_max = 500</span>

    <span class="c1"># Default values</span>
    <span class="n">precisionTheta</span> <span class="o">=</span> <span class="n">theta_input</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">theta_input</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">precisionPhi</span> <span class="o">=</span> <span class="n">phi_input</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi_input</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">nbTheta</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">theta_max</span> <span class="o">/</span> <span class="n">precisionTheta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">nbPhi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">phi_max</span> <span class="o">/</span> <span class="n">precisionPhi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">nbTheta</span> <span class="o">&gt;</span> <span class="n">nbTheta_max</span><span class="p">:</span>
        <span class="n">precisionTheta</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">nbTheta</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">theta_max</span> <span class="o">/</span> <span class="n">precisionTheta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">nbPhi</span> <span class="o">&gt;</span> <span class="n">nbPhi_max</span><span class="p">:</span>
        <span class="n">precisionPhi</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">nbPhi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">phi_max</span> <span class="o">/</span> <span class="n">precisionPhi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Precision Theta = &quot;</span><span class="p">,</span> <span class="n">precisionTheta</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Precision Phi = &quot;</span><span class="p">,</span> <span class="n">precisionPhi</span><span class="p">)</span>

    <span class="n">theta_output</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="n">precisionTheta</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbTheta</span><span class="p">)])</span>
    <span class="n">phi_output</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="n">precisionPhi</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbPhi</span><span class="p">)])</span>

    <span class="k">return</span> <span class="n">theta_output</span><span class="p">,</span> <span class="n">phi_output</span></div>
</pre></div>

            </article>
            

            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
            
          </div>
          
          
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Ansys Inc.
</p>

  </div>
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright (c) 2023 ANSYS, Inc. All rights reserved.<br>

</p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
Last updated on None.<br>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </div>
        </footer>
        

      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  </body>
</html>